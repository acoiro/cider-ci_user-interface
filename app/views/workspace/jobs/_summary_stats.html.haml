-#  Copyright (C) 2013, 2014, 2015 Dr. Thomas Schank  (DrTom@schank.ch, Thomas.Schank@algocon.ch)
-#  Licensed under the terms of the GNU Affero General Public License v3.
-#  See the LICENSE.txt file provided with this software.

- job ||= @job
- cs = @job_cache_signatures ? @job_cache_signatures.select{|cs| cs.job_id == job.id}.first :  job.job_cache_signature
- cache [cs.tasks_signature || job.cache_signature] do |cache_tag|
  - _stat = job.job_stat

  #stats-and-progress.reload.replace-without-animation{data: {state: job.state, cache_tag: _stat}}
    %table.stats-and-progress.result-summary
      %thead 
      %tbody
        %tr
          - Constants::JOB_STATES.each do |state|
            - if _stat[state] > 0
              - fraction= _stat[state]/_stat[:total].to_f
              %td{class: state,data:{ fraction: fraction },style: "width: #{fraction*100}%"}
                - unless job.result_summary? 
                  =_stat[state]
                  %i{class: icon_class_for_state(state)}
                - else 
                  = job.result['summary']
